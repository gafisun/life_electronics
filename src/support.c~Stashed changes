#include "support.h"

int step0 = 0;
int offset0 = 0;
int step1 = 0;
int offset1 = 0;
int volume = 2400;

//wave parameters
double A = 1.0;
double beta = 4.0; // High modulation depth
double K = 1.4142; // Inharmonic ratio (sqrt(2))


void init_wavetable(void) {
    for(int i=0; i < N; i++) {
        double phase = 2.0 * M_PI * i / N;
        double wave_fm = A * sin(phase + (beta * sin(K * phase)));;
        wavetable[i] = (16383 * (wave_fm)) + 16384;
    }
}
const double ATTACK_CUTOFF = .1 * N;
const double ATTACK_MAX = 1;
const double DIP_CUTTOFF = .2 * N;
const double DIP_DOWN = .2;
const double HOLD_CUTTOFF = .6 * N;
const double HOLD_LEVEL = DIP_MIN;
const double DECAY_CUTOFF = N;



void init_envelope(void) {
    for(int i=0; i < N; i++) {
        double wave_en = 0;
        if (i < (int)ATTACK_CUTTOFF) {
            wave_en = ATTACK_MAX * (i/ATTACK_CUTOFF);
        } else if (i < (int)DIP_CUTTOFF) {
            wave_en = ATTACK_MAX - DIP_DOWN * 
        }
        
    }
}


void set_freq(int chan, float f) {
    if (chan == 0) {
        if (f == 0.0) {
            step0 = 0;
            offset0 = 0;
        } else
            step0 = (f * N / RATE) * (1<<16);
    }
    if (chan == 1) {
        if (f == 0.0) {
            step1 = 0;
            offset1 = 0;
        } else
            step1 = (f * N / RATE) * (1<<16);
    }
}